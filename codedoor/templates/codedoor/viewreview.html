{% extends 'codedoor/base.html' %}
{% load static %}
{% block content %}

<head>
  <link rel="stylesheet" type="text/css" href="{% static 'css/basecompany1.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/applications.css' %}">
  <script src="{% static 'js/viewcompany_tabs.js' %}"></script>
</head>
<body>
  <div class="companyportion">
    <div class="company-logo">
    <img src="{{review.company.logo}}" alt="Company logo" width="150" height="150">

    <div class='sub1'><h1>{{review.company.name}}</h1><br>
      <p>{{review.company.industry }}, {{review.company.structure}}</p><br>
      <img src="{% static 'images/linklogo.png' %}" class='logo' width="20px" height="20px" /> <span>{{review.company.website}}</span>
      <img src="{% static 'images/locationlogo.png' %}" class='logo' width="20px" height="20px" /> <span>Mountain View</span>
    </div>

    </div>
  </div>

  <hr id="break">
  <br>

<div id="bottom-half">
  <div id="reviews">
    <table>
      <tr>
        {% if review.company.logo != null %}
          <td rowspan="3" width="7%">
            <img src="{{review.company.logo}}" alt="Company logo" width="100" height="100">
          </td>
        {% else %}
          <td rowspan="3" width="7%">
            <img src="/static/images/temp.png" alt="Company logo" width="100" height="100">
          </td>
        {% endif %}
        <td width="93%">
          <a href="{% url 'codedoor:viewcompany' pk=review.company.pk %}">
            <h2 class="link-text">{{ review.company }}</h2>
          </a>
          <span class="applicant-name">{{ review.reviewer }}</span>
        </td>
      </tr>
      <tr>
        <td>
          {% if review.title != null %}
            <a class="button" id="reviewtitle" href="{% url 'codedoor:viewreview' pk=review.pk  %}">{{review.title}}</a>
          {% else %}
            <p></p>
          {% endif %}
        </td>
      </tr>
      <tr>
        <td>
          <p><span class="info colorful-boxy">
            {% if review.recommend %}
              <span>
                <svg width="15" height="15">
                <rect x="0" y="0" rx="3" ry="3" width="15" height="15"
                style="fill:#01959b" />
                </svg> Recommends
              </span>
            {% else %}
              <span>
                <svg width="15" height="15">
                <rect x="0" y="0" rx="3" ry="3" width="15" height="15"
                style="fill:#ff4d4d" />
                </svg> Doesn't Recommend
              </span>
            {% endif %}
          </span>
          <span class="info colorful-boxy">
            {% if review.rating < 1 %}
              <span>
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
              </span>
            {% elif review.rating < 2 %}
              <span>
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
              </span>
            {% elif review.rating < 3 %}
              <span>
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
              </span>
            {% elif review.rating < 4 %}
              <span>
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
              </span>
            {% elif review.rating < 5 %}
              <span>
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/whitestar.png" height="20" width="20">
              </span>
            {% else %}
              <span>
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
                <img src="/static/images/blackstar.png" height="20" width="20">
              </span>
            {% endif %}
          </span></p>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <div>
            <h4>Description:</h4>
            <p class="description_small_text">{{review.review}}</p>
          </div>
        </td>
      </tr>
    </table>
    <br>
  </div>




</div>
<div id="comments">
  <hr id="break">
  <br>


<div id="commentsection">
  <h2>Add comment</h2>

  Title: <input id="addtitle" type="text" name="title"> <br>
  Body: <input id="addbody" type="text" name="body"> <br>

  <button id="submit">submit</button>

  <h2>comments</h2>
  {% if comments %}
      <div id="list" class="commentlist">
      {% for comment in comments %}
          <div class="comment">
              <h3>{{ comment.title }}</h3>
              <em>{{ comment.pub_date }}</em>
              <p>{{ comment.body }}</p>
          </div>
      {% endfor %}
      </div>
  {% else %}
      <p>No comments yet!</p>
  {% endif %}




</div>




  <div>
    <br><br><br>
      {% if review.reviewer.user == request.user %}
        <a class="sub" href="{% url 'codedoor:editreview' pk=review.pk %}">Edit Review</a>
      {% else %}
        <p></p>
      {% endif %}
    <br>
  </div>




</div>


<script>



function myFunction() {
    alert("Hello! I am an alert box!");
}


function getCookie(name) {
  var regexp = new RegExp("(?:^" + name + "|;\s*"+ name + ")=(.*?)(?:;|$)", "g");
  var result = regexp.exec(document.cookie);
  return (result === null) ? null : result[1];
}

console.log("Do somethings");
    document.getElementById("submit").addEventListener("click", function() {
        var title = document.getElementById("addtitle").value;
        var body = document.getElementById("addbody").value;

        var commentData = new FormData();
        commentData.append("title", title);
        commentData.append("content", content);
        commentData.append("review", {{ review }} )
        var headers = new Headers();

        var csrftoken = getCookie("csrftoken")
        console.log(csrftoken);
        headers.append('X-CSRFToken', csrftoken);

        fetch("/comments/add/", {
            method: "POST",
            body: commentData,
            headers: headers,
            credentials: "include"
        }).then(function(response) {
            return response.json();
        }).then(function(json) {
            if (json.success) {
                document.getElementById("list").innerHTML = "<div class='comment'><h3>" +
                json.title + "</h3><em>" + json.content + "</em><p>" + json.content + "</p></div>" + document.getElementById("list").innerHTML;
            }
        })
    });
</script>
</body>
{% endblock %}

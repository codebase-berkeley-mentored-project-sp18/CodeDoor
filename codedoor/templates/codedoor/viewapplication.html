{% extends 'codedoor/base.html' %}
{% load static from staticfiles %}
{% block content %}
<head>
    <link rel="stylesheet" href="{% static 'css/application.css' %}">
    <link rel="stylesheet" href="{% static 'css/question.css' %}">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body>
  <div class="entry">
    <div id="blackout">

     </div>
    <table>
      <tr>
        {% if a.company.logo != null %}
          <td rowspan="3" width="7%">
            <img src="{{ a.company.logo }}" alt="Company logo" width="100" height="100">
          </td>
        {% else %}
          <td rowspan="3" width="7%">
            <img src="/static/images/temp.png" alt="Company logo" width="100" height="100">
          </td>
        {% endif %}
        <td width="93%">
          <a href="{% url 'codedoor:viewcompany' pk=a.company.pk %}">
            <h2 class="link-text">{{ a.company }}</h2>
          </a>
          <span class="applicant-name">{{ a.profile }}</span>
        </td>
      </tr>
      <tr>
        <td>
          <p><span class="info job-position">{{a.position}}</span>
          <span class="info job-season">{{a.season}} {{a.year}}-San Francisco, CA</span></p>
        </td>
      </tr>
      <tr>
        <td>
          <p><span class="info colorful-boxy">
            {% if a.received_offer %}
              <span>
                <svg width="15" height="15">
                <rect x="0" y="0" rx="3" ry="3" width="15" height="15"
                style="fill:#01959b" />
                </svg> Received Offer
              </span>
            {% else %}
              <span>
                <svg width="15" height="15">
                <rect x="0" y="0" rx="3" ry="3" width="15" height="15"
                style="fill:#ff4d4d" />
                </svg> No Offer
              </span>
            {% endif %}
          </span>
          <span class="info colorful-boxy">
            {% if a.difficult > 7 %}
              <span>
                <svg width="15" height="15">
                <rect x="0" y="0" rx="3" ry="3" width="15" height="15"
                style="fill:#ff4d4d" />
                </svg>&nbsp;&nbsp;Difficult Interview: {{a.difficult}}/10
              </span>
            {% elif a.difficult < 4 %}
              <span>
                <svg width="15" height="15">
                <rect x="0" y="0" rx="3" ry="3" width="15" height="15"
                style="fill:#01959b" />
                </svg>&nbsp;&nbsp;Easy Interview: {{a.difficult}}/10
              </span>
            {% else %}
              <span>
                <svg width="15" height="15">
                <rect x="0" y="0" rx="3" ry="3" width="15" height="15"
                style="fill:#FF9B71;" />
                </svg>&nbsp;&nbsp;Average Interview: {{a.difficult}}/10
              </span>
            {% endif %}
          </span></p>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <h4>Description:</h4>
          <p>{{a.description}}</p>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <h4>Offer details:</h4>
          <p>{{a.offer_details}}</p>
        </td>
      </tr>
    </table>
    <br><br>
        <a class="sub" id="addcomment" href="#">Add Comment</a>
        {% if request.user.profile == profile %}
          <a class="sub" href="{% url 'codedoor:create_question' pk=a.pk %}">Create Question</a>
          <a class="sub" href="{% url 'codedoor:edit_application' pk=a.pk %}">Edit Application</a>
        {% endif %}
    <br><br><br>
    <h2>Questions</h2>
    {% if questions %}
        <div class="questList">
        {% for q in questions %}
            <div class="post">
                <h4 class="blue-text">Question</h4>
                <p>{{ q.question }}</p>
                <h4 class="blue-text">Applicant answer</h4>
                <p>{{ q.applicant_answer }}</p>
                <h4 class="blue-text">Company answer</h4>
                <p>{{ q.actual_answer }}</p>
                <br><br>
            </div>
        {% endfor %}
        </div>
    {% else %}
        <p>No questions yet!</p>
    {% endif %}
    <br><br>
    <h2> Comments </h2>
    {% if comments %}
      {% for comment in comments %}
          <div id="comment">
            <div id="profile-img" style="background-image: url('{{ comment.commenter.profile_pic }}');">
            </div>
            <p id="commenter"> {{comment.commenter}} </p>
            <p style="padding-left:40px;"> {{comment.content}} </p><br>
          </div>
      {% endfor %}
    {% else %}
      <p> No comments yet! </p>
    {% endif %}
  </div>
  <div id="commentsection">
  <h2>Add comment</h2><br>

  Title <input id="addtitle" type="text" name="title"> <br><br>
  Comment <br><textarea id="addbody" name="body" placeholder="Review here"></textarea><br><br>
  <input id ="reviewpk" type="hidden" name="review" value="{{ review.pk }}"><br><br>

  <button class="sub" id="submit">Submit</button>
  <button class="sub" id="cancel">Cancel</button>
</div>

<script type="text/javascript">
document.getElementById("blackout").style.display = "none";
function myFunction() {
    alert("Hello! I am an alert box!");
}

function getCookie(name) {
  var regexp = new RegExp("(?:^" + name + "|;\s*"+ name + ")=(.*?)(?:;|$)", "g");
  var result = regexp.exec(document.cookie);
  return (result === null) ? null : result[1];
}

function displayCommentSection() {
    var x = document.getElementById("commentsection");
    if (x.style.display != "block") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}

$( function() {
    $( "#commentsection" ).dialog({
      autoOpen: false,
      show: {
        effect: "fade",
        duration: 300
      },
      hide: {
        effect: "close",
        duration: 1000
      }
    });

    $(".ui-dialog-titlebar").hide();
    $( "#commentsection" ).dialog({ closeOnEscape: false });

    $( "#addcomment" ).on( "click", function() {
     document.getElementById("blackout").style.display = "block";
      $( "#commentsection" ).dialog( "open" );
    });
  } );

console.log("Do somethings");

  document.getElementById("cancel").addEventListener("click", function() {

document.getElementById("blackout").style.display = "none";
$( "#commentsection" ).dialog( "close" );
});




    document.getElementById("submit").addEventListener("click", function() {
        console.log("In the addEventListener");
        document.getElementById("blackout").style.display = "none";


        var title = document.getElementById("addtitle").value;
        var content = document.getElementById("addbody").value;

        var commentData = new FormData();
        commentData.append("title", title);
        commentData.append("content", content);
        var application = document.getElementById("applicationpk").value;
        commentData.append("application", application )
        var headers = new Headers();

        var csrftoken = getCookie("csrftoken")
        headers.append('X-CSRFToken', csrftoken);
        console.log("did not error out");
        fetch("/codedoor/addac/", {
            method: "POST",
            body: commentData,
            headers: headers,
            credentials: "include"
        }).then(function(response) {
            return response.json();
        }).then(function(json) {
            if (json.success) {
                document.getElementById("comment").innerHTML =


                "<div id=\"comment\"><div id=\"profile-img\" style=\"background-image: url(" +json.profile_url+ ");\">"
                  +"</div><p id='commenter'>"+json.name+"</p>"
                  +"<p class='commentcontents'>"+json.content+"</p><br></div>"
                   + document.getElementById("comment").innerHTML;
            }
        })


         $( "#commentsection" ).dialog( "close" );


    }



  );
</script>
</body>
{% endblock %}
